<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detail e-commerce</title>
    <link rel="icon" href="assets/image/logo.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="assets/css/style.css" type="text/css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">
          <img src="assets/image/logo.png" alt="logo" />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                SHOP
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="#">Something else here</a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link" aria-disabled="true">PAYMENT CONFIRMATION</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="track-order.html">TRACK YOUR ORDER</a>
            </li>
          </ul>
          <form class="d-flex" role="search">
            <!-- <input
                class="form-control me-2"
                type="search"
                placeholder="Search"
                aria-label="Search"
              /> -->
            <button class="btn-navbar" type="submit">
              <iconify-icon
                icon="fluent:search-20-regular"
                width="30"
              ></iconify-icon>
            </button>
          </form>
          <button class="btn-navbar">Login</button>
          <button class="btn-navbar" id="sidebarCart">
            Cart
            <iconify-icon icon="fe:cart"></iconify-icon>
          </button>
        </div>
      </div>
    </nav>
    <div id="tes"></div>
    <div class="container mt-5">
      <div class="row">
        <div class="col-lg-5 mt-3">
          <div
            id="carouselExampleIndicators"
            class="carousel slide"
            data-bs-ride="carousel"
          >
            <div class="carousel-indicators" id="indicator"></div>
            <div class="carousel-inner" id="image-product"></div>
            <button
              class="carousel-control-prev"
              type="button"
              data-bs-target="#carouselExampleIndicators"
              data-bs-slide="prev"
            >
              <span
                class="carousel-control-prev-icon"
                aria-hidden="true"
              ></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button
              class="carousel-control-next"
              type="button"
              data-bs-target="#carouselExampleIndicators"
              data-bs-slide="next"
            >
              <span
                class="carousel-control-next-icon"
                aria-hidden="true"
              ></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
        </div>
        <div class="col-lg-7 mt-3">
          <h3 id="title-product"></h3>
          <p id="harga-product"></p>
          <form>
            <label for="variant">Varian :</label>
            <select class="w-25 form-select" id="select-varian"></select>
            <br />
            <br />
            <br />
            <button type="button" id="button" class="btn-detail">
              Add to Cart
            </button>
          </form>
          <div class="container mt-3">
            <h5>Deskripsi :</h5>
            <p id="product-description"></p>
          </div>
        </div>
      </div>
    </div>
    <footer class="container row" style="margin: 200px auto">
      <div class="col-lg-4 mt-3">
        <h3 class="text-center">Help</h3>
        <div class="d-flex justify-content-center">
          <button class="btn btn-outline-success d-flex align-items-center">
            <iconify-icon icon="logos:whatsapp-icon" width="30"></iconify-icon>
            <span class="mx-2">Silahkan hubungi kami</span>
          </button>
        </div>
      </div>
      <div class="col-lg-4 mt-3">
        <h3 class="text-center">About Us</h3>
        <div class="text-center">
          <p>
            Lorem Ipsum is simply dummy text of the printing and typesetting
            industry. Lorem Ipsum has been the industry's standard dummy text
            ever since the 1500s, when an unknown printer took a galley of type
            and scrambled it to make a type specimen book. It has survived not
            only five centuries, but also the leap into electronic typesetting,
            remaining essentially unchanged.
          </p>
        </div>
      </div>
      <div class="col-lg-4 mt-3">
        <h3 class="text-center">Contact Us</h3>
        <div class="d-flex justify-content-center gap-2">
          <a href="#" class="btn"
            ><iconify-icon icon="line-md:instagram" width="30"></iconify-icon
          ></a>
          <a href="#" class="btn"
            ><iconify-icon
              icon="ant-design:facebook-outlined"
              width="30"
            ></iconify-icon
          ></a>
          <a href="#" class="btn"
            ><iconify-icon icon="simple-icons:shopee" width="30"></iconify-icon
          ></a>
          <a href="#" class="btn"
            ><iconify-icon icon="ri:line-line" width="30"></iconify-icon
          ></a>
        </div>
      </div>
    </footer>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
  </body>
</html>
<script>
  $.urlParam = function (name) {
    var result = new RegExp("[?&]" + name + "=([^&#]*)").exec(
      window.location.href
    );
    return result !== null ? result[1] || 0 : false;
  };

  var id = $.urlParam("id");

  function populateVarian(data, index) {
    var varian = `
      <option value="${data.product_id}" data-price="${data.product_price}">${data.varian_keyword_value}</option>
      `;
    $("#select-varian").append(varian);
    if (index === 0) {
      updatePrice(data.product_price);
      updateProductName(data.product_name);
      // updateImage(data.product_img);
      updateDescription(data.product_description);
    }
  }

  $("#select-varian").on("change", function () {
    var selectedOption = $(this).find("option:selected");
    var selectedPrice = selectedOption.data("price");

    updatePrice(selectedPrice);
  });

  function formatRupiah(number) {
    var formater = new Intl.NumberFormat("id-ID", {
      style: "currency",
      currency: "IDR",
      minimumFractionDigits: 0,
    });

    return formater.format(number).replace(/\s/g, "").replace(",00", ",-");
  }

  function updatePrice(data) {
    var price = formatRupiah(data);
    $("#harga-product").text(price);
  }

  function updateProductName(data) {
    $("#title-product").text(data);
  }

  function updateDescription(data) {
    $("#product-description").text(data);
  }

  function updateImage(data) {
    console.log(data);
    var image = "";
    var indicator = "";
    var count = 0;
    data.forEach(function (item) {
      indicator += `
      <li
        data-bs-target="#carouselExampleIndicators"
        data-bs-slide-to="${count}"
        ${count === 0 ? 'class="active"' : ""}
      ></li>
    `;
      image += `
      <div class="carousel-item ${count === 0 ? "active" : ""}">
        <img src="https://sistemtoko.com/img/user/demo/product/${
          item.product_gallery_img
        }" class="d-block w-100" alt="${item.product_gallery_img}" />
      </div>
    `;
      count++;
    });
    $("#indicator").append(indicator);
    $("#image-product").append(image);
  }

  $.get("https://sistemtoko.com/public/demo/product/" + id, function (data) {
    try {
      var parsedData = JSON.parse(data);
      // console.log(parsedData);
      updateImage(parsedData.gallery);
    } catch (error) {
      console.error("Gagal mengurai JSON:", error);
    }
  });

  $.get("https://sistemtoko.com/public/demo/varian/" + id, function (response) {
    response.forEach((data, index) => {
      populateVarian(data, index);
    });
  });

  //CART
  $(document).ready(function () {
    $.ajaxSetup({
      headers: { "X-Requested-With": "XMLHttpRequest" },
    });

    $.get("https://demo.sistemtoko.com/api-view/cart", function (data) {
      $("#tes").append(data);
    });
    $("#button").click(function () {
      var selectedvarian = $("#select-varian option:selected").val();
      $.get(
        "https://sistemtoko.com/public/demo/single/" + selectedvarian,
        function (data) {
          // console.log(data);
          product_id = data.product_id;
          product_name = data.product_name;
          product_img = `https://sistemtoko.com/img/user/demo/product/${data.product_img}`;
          product_price = parseFloat(data.product_price).toString();
          product_qty = 0;
          product_weight = data.product_weight;
          product_stock = data.product_qty_stock;
          varian = data.varian_keyword_value;
          window.addCart(
            product_id,
            product_name + " - " + varian,
            product_img,
            product_price,
            product_weight
          );
        }
      );
    });
  });

  $(document).ready(function () {
    $("#sidebarCart").click(function () {
      if ($("#cart-wrapper").hasClass("toggled")) {
        $("#cart-wrapper").removeClass("toggled");
      } else {
        $("#cart-wrapper").addClass("toggled");
      }
    });
  });
</script>
